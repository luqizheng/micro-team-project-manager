# ALIGNMENT_GitLab分组映射功能

## 项目上下文分析

### 现有项目结构
- **技术栈**: Vue3 + Ant Design (前端), NestJS + TypeORM + MySQL (后端)
- **现有GitLab集成**: 已实现项目映射、用户映射、Epic映射等功能
- **数据库**: MySQL 8，使用TypeORM作为ORM
- **API客户端**: 使用@gitbeaker/rest作为GitLab API客户端

### 现有GitLab集成功能
1. **项目映射**: GitLabProjectMapping实体，支持PM项目与GitLab项目的映射
2. **用户映射**: GitLabUserMapping实体，支持PM用户与GitLab用户的映射  
3. **Epic映射**: GitLabEpicMapping实体，支持PM Epic与GitLab Epic的映射
4. **API服务**: 已实现GitLab API的完整封装，包括项目、用户、Epic等操作
5. **前端组件**: 已实现GitLab集成相关的Vue组件

### 现有代码模式
- 使用DDD架构模式，分为core、application、infrastructure、presentation层
- 实体使用TypeORM装饰器定义
- 服务层使用NestJS依赖注入
- 前端使用Vue3 Composition API + Ant Design

## 需求理解确认

### 原始需求
实现GitLab分组(Group)与PM中项目(Project)的映射功能，包括前后台相关修改。

### 需求理解
基于现有GitLab集成架构，需要新增GitLab分组映射功能：

1. **数据模型**: 创建GitLabGroupMapping实体，建立PM项目与GitLab分组的映射关系
2. **API服务**: 扩展GitLab API服务，支持分组相关操作
3. **业务逻辑**: 实现分组映射的CRUD操作
4. **前端界面**: 在项目管理界面添加分组映射功能
5. **权限控制**: 确保只有管理员和项目管理员可以管理分组映射

### 边界确认
- **包含范围**:
  - 创建GitLab分组映射实体
  - 实现分组映射的CRUD API
  - 添加分组列表获取API
  - 前端分组映射管理界面
  - 分组映射的权限控制

- **不包含范围**:
  - 分组内项目的自动同步
  - 分组成员的自动同步
  - 分组级别的权限管理
  - 分组统计信息展示

### 疑问澄清

1. **映射关系**: 一个PM项目是否可以映射到多个GitLab分组？还是只能一对一映射？
   - 建议：支持一对多映射，一个PM项目可以关联多个GitLab分组

2. **分组选择**: 是否需要支持按权限过滤可选择的GitLab分组？
   - 建议：显示用户有访问权限的分组列表

3. **映射验证**: 创建映射时是否需要验证用户对GitLab分组的访问权限？
   - 建议：需要验证，确保用户有权限访问该分组

4. **分组信息展示**: 映射后是否需要展示分组的详细信息（如项目数量、成员数量等）？
   - 建议：在映射列表中展示基本分组信息

5. **映射状态**: 是否需要支持映射的启用/禁用状态？
   - 建议：支持，与现有项目映射保持一致

## 项目特性规范

### 技术约束
- 必须与现有GitLab集成架构保持一致
- 使用现有的TypeORM实体模式
- 遵循现有的API设计规范
- 使用现有的权限控制机制

### 集成方案
- 复用现有的GitLab API服务
- 扩展现有的GitLab集成控制器
- 集成到现有的项目管理界面
- 使用现有的错误处理和日志记录机制

### 数据一致性
- 映射关系需要支持软删除
- 删除PM项目时级联删除相关映射
- 删除GitLab实例时级联删除相关映射
- 支持映射状态的审计日志

## 验收标准

### 功能验收
1. 能够创建PM项目与GitLab分组的映射关系
2. 能够查看、编辑、删除分组映射
3. 能够获取GitLab分组列表（带权限过滤）
4. 前端界面友好，操作流程清晰
5. 权限控制正确，只有授权用户可以管理映射

### 技术验收
1. 代码符合项目现有规范
2. 数据库迁移脚本正确
3. API接口文档完整
4. 单元测试覆盖核心功能
5. 集成测试通过

### 性能验收
1. 分组列表加载时间 < 3秒
2. 映射操作响应时间 < 2秒
3. 支持分页加载大量分组数据
4. 内存使用合理，无内存泄漏
