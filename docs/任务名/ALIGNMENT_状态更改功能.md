# ALIGNMENT_状态更改功能

## 项目上下文分析

### 现有项目结构
- 前端：Vue3 + Ant Design Vue + TypeScript
- 后端：NestJS + TypeORM + MySQL
- 项目类型：微团队项目管理工具

### 现有代码模式
- 已有StateSelector组件用于状态选择
- 已有状态转换API接口 `/projects/:projectId/issues/:id/transition`
- 已有changeState方法但未在UI中使用
- 状态显示使用a-tag组件，支持颜色区分

### 业务域理解
- 支持三种事项类型：requirement、task、bug
- 每种类型有对应的状态配置
- 状态转换需要权限控制（member、project_manager）
- 状态有颜色标识和排序

## 需求理解确认

### 原始需求
在IssueDetail.vue的状态显示区域添加状态更改功能，允许用户直接更改事项状态。

### 边界确认
- 仅修改IssueDetail.vue文件
- 复用现有的StateSelector组件
- 保持现有的权限控制逻辑
- 保持现有的状态颜色显示
- 不修改后端API接口

### 需求理解
1. 将当前只读的状态标签替换为可交互的状态选择器
2. 状态选择器需要根据事项类型加载对应的状态列表
3. 状态更改后需要调用现有的changeState方法
4. 需要保持权限控制，只有有权限的用户才能更改状态
5. 状态更改成功后需要显示成功消息并刷新状态

### 疑问澄清
1. 是否需要在状态更改时添加确认对话框？
2. 是否需要显示状态转换的历史记录？
3. 是否需要限制某些状态之间的转换？

## 技术实现方案

### 前端实现
1. 导入StateSelector组件
2. 将状态显示区域从a-tag改为StateSelector
3. 添加状态更改处理函数
4. 保持现有的权限控制逻辑

### 集成方案
- 复用现有的changeState方法
- 复用现有的loadAvailableStates方法
- 保持现有的权限检查逻辑

## 验收标准
1. 状态显示区域可以点击并选择新状态
2. 状态更改后立即生效并显示成功消息
3. 只有有权限的用户才能看到状态选择器
4. 状态选择器根据事项类型显示正确的状态列表
5. 状态更改失败时显示错误消息并恢复原状态
