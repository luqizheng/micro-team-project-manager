## 架构与技术选型

### 1. 架构风格
- 前后端分离，RESTful API + Webhook；事件驱动（用于集成与通知），任务与消息异步。
- MVP 阶段以单体为主，预留模块化边界；后续可演进为服务化（看板/事项、搜索、通知、集成）。

### 2. 逻辑分层
- 表现层（Web/PWA）：看板、列表、报表、文档、设置。
- 应用层：用例编排、权限校验、事务。
- 领域层：领域对象、聚合、领域服务、仓储接口。
- 基础设施层：数据库、缓存、对象存储、外部适配器、消息队列。

### 3. 技术栈（建议）
- 前端：Vue 3 + TypeScript + Vite + Pinia；UI（Ant Design Vue）；路由（Vue Router）。
- 后端：Node.js + TypeScript（NestJS/Fastify）或 Go（Gin/Fiber）。优先 NestJS（生态与脚手架完整）。
- 数据库：MySQL 8；ORM（Prisma/TypeORM）。
- 缓存/消息：Redis（缓存、分布式锁、队列）。
- 对象存储：S3 兼容（MinIO/阿里云 OSS）。
- 搜索：MySQL 全文检索，必要时接入 OpenSearch。
- CI/CD：GitHub Actions / GitLab CI；容器化（Docker Compose/K8s 可选）。

### 4. 关键组件与职责
- API 网关/服务：统一鉴权、速率限制、审计；路由到业务服务。
- 事项服务：需求/任务/缺陷 CRUD、状态机、看板流转、关联关系。
- 迭代与版本服务：容量、燃尽、发布单生成。
- 评论与文档服务：富文本、附件、历史版本、全文搜索。
- 通知与订阅服务：站内、邮件、Webhook、规则。
- 集成适配层：Git/CI/IM 适配，入站回调验签、签名与重试；出站关注幂等。

### 5. 集成设计
- 统一集成抽象：`Provider` 接口（鉴权、Webhook 验签、事件映射、API 调用）。
- 失败与重试：指数退避，死信队列；可视化重放。
- 安全：签名算法（HMAC-SHA256）、IP 白名单、令牌轮换。

### 6. 数据存储设计要点
- 事务边界清晰；写入采用乐观锁或版本号；
- 审计字段与软删；
- 热路径加索引（项目+状态+负责人，更新时间倒序）；
- 附件走对象存储，数据库仅存元数据与签名 URL。

### 7. 可观测性
- 日志：结构化日志（JSON），TraceId 贯穿；
- 指标：QPS、P95 延迟、错误率、队列滞留、Webhook 成功率；
- 链路追踪：OpenTelemetry；
- 告警：阈值+异常突增混合策略。

### 8. 安全与权限
- 鉴权：JWT（短期）+ 刷新；可选 OIDC/企业微信登录；
- 授权：RBAC；项目作用域；字段级过滤（数据隔离）。
- 输入校验与输出编码；CSRF 防护；CSP；依赖漏洞扫描。

### 9. 部署与运维
- 本地：`docker compose up -d` 一键拉起（MySQL/Redis/MinIO/Server/Web）。
- 测试/预发/生产分层；数据库迁移工具（Prisma Migrate）。
- 备份：每日快照；对象存储版本化；灾备演练。

### 10. 性能策略
- 分页与延迟加载；列表列裁剪与后端聚合；
- 批量接口、幂等；
- Redis 缓存常用查询与计数；
- 只在需要时引入搜索引擎，避免过早复杂化。


