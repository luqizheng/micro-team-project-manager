## 数据模型（WorkItem 统一版）

### 1. 关键实体
- 用户 User / 认证 Credential
- 项目 Project、成员 Membership（角色关系）
- 工作项 WorkItem（统一：`type` ∈ task|bug）、需求 Requirement
- 看板 Board、列 Column、WIP 规则 WipRule
- 迭代 Sprint、版本 Release
- 评论 Comment、附件 Attachment、标签 Label、订阅 Subscription
- 通知 Notification、Webhook、自动化规则 Rule

### 2. 核心表（现行）
- `users`：id, email, name, status, avatar, created_at, updated_at
- `projects`：id, key, name, visibility, created_by, created_at, updated_at, archived
- `memberships`：id, project_id, user_id, role, created_at
- `work_items`：id, project_id, type, title, description, state, priority, severity, assignee_id, reporter_id, story_points, estimate_minutes, remaining_minutes, estimated_hours, actual_hours, sprint_id, release_id, parent_id, requirement_id, subsystem_id, feature_module_id, labels, due_at, created_at, updated_at, deleted
- 其余表：`boards`、`board_columns`、`comments`、`attachments`、`sprints`、`releases`、`notifications`、`webhooks`、`rules`

### 3. 关系概要
- 项目 1..n WorkItem；WorkItem 与 迭代/版本/需求/子系统/功能模块 均为可选 n..1 关系；WorkItem 支持父子关系（子任务）。
- 看板列通过状态映射聚合 WorkItem。
- WorkItem 1..n 评论与附件；n..n 标签（实现上使用 JSON 数组）。

### 4. 状态与流转
- 统一状态：`todo` → `in_progress` → `in_review`/`blocked` → `done`
- `bug` 类型要求 `severity`；`task` 类型支持工时/故事点。

### 5. 索引建议
- `work_items(project_id, type, state, assignee_id, updated_at desc)` 复合索引
- 文本字段可按需加全文索引（title, description）

### 6. 审计与软删
- 核心表具备 `created_at`/`updated_at` 与 `deleted` 软删标志。

### 7. ER 图（Mermaid）
```
Project --< WorkItem
Requirement --< WorkItem
Subsystem --< WorkItem
FeatureModule --< WorkItem
WorkItem --< Comment
WorkItem --< Attachment
Project --< Board --< Column
```

