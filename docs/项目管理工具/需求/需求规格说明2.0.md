## 需求规格说明（SRS）2.0

### 1. 引言
- **目的**：明确小型团队开发管理工具在业务与功能层面的完整需求，作为设计、开发与测试的依据。
- **范围**：覆盖项目/需求/任务/缺陷/功能模块/子系统、看板、迭代、版本、文档、通知、报表、集成与权限。
- **读者**：产品、研发、测试、实施与运维。

### 2. 术语
- **任务（Task）**：具体的工作单元，可分配给个人完成
- **缺陷（Bug）**：系统中发现的问题或错误
- **功能模块（Feature Module）**：独立的功能组件，包含多个相关任务。它属于 subsystem 或者单独存在
- **子系统（Subsystem）**：系统的子部分，包含多个功能模块
- **需求（Requirement）**：业务或技术需求，可分解为功能模块或任务
- **迭代（Sprint）**：固定周期的开发与交付单元
- **版本（Release）**：一组变更的可交付物
- **GitLab Group**：GitLab中的组织单元，用于管理多个相关项目，对应PM系统中的项目
- **GitLab Epic**：GitLab中的大型工作项，用于组织和管理相关的工作，对应PM系统中的需求/功能模块/子系统
- **GitLab Issue**：GitLab中的具体工作项，对应PM系统中的任务或缺陷

### 3. 总体描述
- 用户类型：访客、成员、项目管理员、系统管理员。
- 约束：私有化部署优先；国产化 IM/Git 可用；浏览器优先，移动端适配。
- 假设：团队规模 3-20 人；代码托管与 CI 已存在。

### 4. 功能性需求
#### 4.1 项目与成员
- 创建/归档项目；设置可见性；邀请成员、设置角色；项目模板。

#### 4.2 需求管理
- 创建/编辑/删除/归档需求；优先级、故事点、标签；需求与功能模块、子系统的关联；评审记录与通过状态。

#### 4.3 功能模块管理
- 创建/编辑/删除功能模块；模块描述、负责人、计划时间；模块与任务、缺陷的关联；模块状态跟踪。

#### 4.4 子系统管理
- 创建/编辑/删除子系统；子系统描述、架构设计；子系统与功能模块的层级关系；子系统状态跟踪。

#### 4.5 任务与看板
- 支持列自定义、WIP 限制；泳道与排序；批量拖拽移动；任务支持负责人、计划时间、预估与剩余工时、子任务与清单、附件与评论。

#### 4.6 缺陷管理
- 严重级/优先级、来源、影响范围；状态流转与重开；回归验证；与版本关联；重复缺陷合并。

#### 4.7 层级关系管理
- **PM系统层级结构**：
  - 需求 → 子系统 → 功能模块 → 任务/缺陷
  - 任务属于需求/功能模块/子系统下的子项
  - 缺陷属于功能模块/子系统下的子项
- 支持层级间的依赖关系跟踪
- 支持跨层级的状态汇总和进度统计
- **GitLab集成映射**：
  - PM项目 → GitLab Group：PM系统中的项目对应GitLab的Group
  - 需求/功能模块/子系统 → GitLab Epic：支持将高层级工作项映射到GitLab Group下的Epic
  - 任务/缺陷 → GitLab Issue：支持将具体工作项映射到GitLab Group下的Issue
  - 双向同步：PM系统与GitLab之间的数据变更自动同步

#### 4.8 迭代与版本
- 迭代创建、容量、起止时间、目标与燃尽图；事项纳入/移出；完成度统计；版本发布单生成与变更列表。

#### 4.9 文档与评论
- 项目内文档：支持目录、全文搜索、版本；评论支持@与引用、代码片段、附件、表情；订阅变更通知。

#### 4.10 搜索与筛选
- 全局搜索；高级筛选（字段条件、日期区间、文本匹配、层级关系）；保存为视图并共享；导出 CSV。

#### 4.11 通知与自动化
- 站内、邮件、Webhook 通知；静默时段；聚合与去重；基于规则的自动指派与流转；日报/周报自动汇总。

#### 4.12 集成
- **GitLab集成**：
  - PM项目 → GitLab Group：PM系统中的项目对应GitLab的Group，支持Group级别的同步
  - 需求/功能模块/子系统 → GitLab Epic：支持将需求、功能模块、子系统映射到GitLab Group下的Epic
  - 任务/缺陷 → GitLab Issue：任务和缺陷作为需求/功能模块/子系统的子项，映射到GitLab Group下的Issue
  - 代码仓库管理：GitLab Project作为代码仓库，PM系统不直接管理，仅用于代码关联和CI/CD集成
  - Git：提交信息与事项关联（含关键字自动流转）；PR/MR 状态回写；Release 说明同步
  - CI：构建/测试/发布状态回写；失败自动标记阻塞并通知
- **其他集成**：
  - IM：命令创建事项、订阅看板事件、群通知

#### 4.13 权限
- 项目级 RBAC；可配置操作粒度（查看/创建/编辑/删除/管理/导出）；私有项目邀请；外部协作者只读。

### 5. 非功能性需求
- 性能：列表查询 < 300ms（典型筛选）；批量导出异步；消息与任务异步化。
- 可靠性：99.9% 可用性目标；数据每日备份；关键操作审计。
- 安全：传输加密、密码策略、CSRF/XSS/SQL 注入防护；WebHook 验签与重试。
- 可用性：响应式设计；键盘快捷键；可达性（a11y）基础支持。
- 可运维：配置化日志级别、指标与告警；安装向导与健康检查。

### 6. 数据要求（摘要）
- 需求、子系统、功能模块、任务、缺陷、评论、附件、用户与成员、标签、看板列、迭代、版本、通知记录等核心表。
- 字段审计：创建者、更新时间、删除标记；软删。
- 层级关系表：支持需求-子系统-功能模块-任务/缺陷的层级结构。
- **GitLab集成表**：
  - GitLab实例配置表：支持多GitLab实例管理
  - 项目映射表：PM项目与GitLab Group的映射关系
  - Epic映射表：需求/功能模块/子系统与GitLab Epic的映射关系
  - Issue映射表：任务/缺陷与GitLab Issue的映射关系
  - 事件日志表：GitLab Webhook事件处理记录

### 7. 约束与依赖
- 浏览器支持：现代 Chrome/Edge/Firefox；移动端自适应。
- 外部依赖：Git/CI/IM 可选；对象存储用于附件；SMTP/企业邮箱。

### 8. 验收标准（示例）
- 可创建项目并配置成员与角色；
- 在看板完成从创建任务到 Done 的全流程；
- 支持需求-子系统-功能模块-任务的层级结构管理；
- **GitLab集成验收**：
  - PM项目可映射到GitLab Group并支持Group级别同步
  - 需求/功能模块/子系统可映射到GitLab Group下的Epic并双向同步
  - 任务/缺陷作为需求/功能模块/子系统的子项，与GitLab Group下的Issue双向同步
  - 层级关系正确维护：任务属于需求/功能模块/子系统，缺陷属于功能模块/子系统
  - GitLab Webhook事件正确接收和处理
  - 多GitLab实例配置和管理功能正常
- 提交信息 `#TASK-1 done` 可自动流转并记录；
- 迭代燃尽可视化且与事项进度一致；
- 发布单可生成并导出；
- 权限管控对不同角色生效；
- 主要列表查询在典型数据量下满足性能指标。

### 9. 风险与缓解
- 集成 API 限频与变化：适配器与容错、重试与缓存。
- 团队习惯迁移：提供模板与向导、导入工具与快捷键。
- 层级关系复杂性：提供简化的层级管理界面和批量操作功能。

