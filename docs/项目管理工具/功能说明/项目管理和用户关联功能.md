# 项目管理和用户关联功能说明

## 概述

实现了完整的项目管理系统，包括项目的新建、编辑、删除功能，以及项目成员的管理功能。用户可以创建项目并关联其他用户作为项目成员，支持不同的角色权限。

## 功能特性

### 1. 项目管理

#### 项目CRUD操作
- **创建项目**：支持设置项目KEY、名称、可见性
- **查看项目**：项目列表和详情页面
- **编辑项目**：修改项目名称和可见性
- **删除项目**：安全删除项目（需确认）
- **归档项目**：归档/取消归档项目

#### 项目信息
- **项目KEY**：唯一标识符，用于项目引用
- **项目名称**：项目的显示名称
- **可见性**：私有（private）或公开（public）
- **状态**：活跃或已归档
- **创建时间**：项目创建的时间戳
- **更新时间**：最后修改的时间戳

### 2. 用户关联管理

#### 成员管理
- **添加成员**：将用户添加到项目中
- **角色管理**：设置成员角色（成员/项目经理）
- **移除成员**：从项目中移除用户
- **成员列表**：查看项目所有成员

#### 角色权限
- **成员（member）**：基础项目访问权限
- **项目经理（project_manager）**：项目管理权限，可管理成员
- **管理员（admin）**：全局管理权限

### 3. 用户界面

#### 项目列表页面（/projects）
- 项目列表展示
- 搜索和筛选功能
- 新建项目按钮
- 项目操作菜单（详情、编辑、归档、删除等）

#### 项目详情页面（/projects/:id）
- 项目基本信息展示
- 成员管理界面
- 快速导航到相关功能
- 项目操作菜单

#### 成员管理组件
- 成员列表展示
- 添加成员模态框
- 角色变更下拉菜单
- 移除成员确认

## 技术实现

### 后端实现

#### API端点
```typescript
// 项目管理
GET    /projects              // 获取项目列表
POST   /projects              // 创建项目
GET    /projects/:id          // 获取项目详情
PATCH  /projects/:id          // 更新项目
DELETE /projects/:id          // 删除项目

// 成员管理
GET    /projects/:id/members           // 获取项目成员
POST   /projects/:id/members           // 添加项目成员
PATCH  /projects/:id/members/:userId   // 更新成员角色
DELETE /projects/:id/members/:userId   // 移除项目成员
```

#### 数据模型
```typescript
// 项目实体
interface ProjectEntity {
  id: string;
  key: string;
  name: string;
  visibility: 'private' | 'public';
  archived: boolean;
  createdBy: string;
  createdAt: Date;
  updatedAt: Date;
}

// 成员关系实体
interface MembershipEntity {
  id: string;
  projectId: string;
  userId: string;
  role: 'member' | 'project_manager';
  joinedAt: Date;
  user: UserEntity; // 关联用户信息
}
```

#### 权限控制
- 使用 `@Roles` 装饰器控制API访问权限
- 基于JWT的身份验证
- 角色基础的访问控制（RBAC）

### 前端实现

#### 组件结构
```
client/src/
├── views/
│   ├── Projects/Projects.vue              // 项目列表页面
│   └── ProjectDetail.vue         // 项目详情页面
├── components/
│   ├── ProjectMemberManager.vue  // 成员管理组件
│   └── UserSelector.vue          // 用户选择组件
└── router.ts                     // 路由配置
```

#### 状态管理
- 使用Vue 3 Composition API
- 响应式数据管理
- 异步操作处理

#### 用户界面
- 基于Ant Design Vue组件库
- 响应式设计
- 直观的操作界面

## 使用指南

### 1. 创建项目

1. 访问项目列表页面（/projects）
2. 点击"新建项目"按钮
3. 填写项目信息：
   - KEY：项目唯一标识符（如：PM）
   - 名称：项目显示名称
   - 可见性：选择私有或公开
4. 点击"确定"创建项目

### 2. 管理项目成员

1. 在项目列表中点击"详情"进入项目详情页面
2. 在"成员管理"部分：
   - 点击"添加成员"添加新成员
   - 选择用户并设置角色
   - 使用角色下拉菜单变更成员角色
   - 点击"移除"删除成员

### 3. 编辑项目

1. 在项目详情页面点击"更多"菜单
2. 选择"编辑项目"
3. 修改项目名称或可见性
4. 点击"确定"保存更改

### 4. 项目操作

- **查看事项**：跳转到项目事项列表
- **新建事项**：创建新的事项
- **归档项目**：归档或取消归档项目
- **删除项目**：永久删除项目（需确认）

## 权限说明

### 角色权限矩阵

| 操作 | 管理员 | 项目经理 | 成员 |
|------|--------|----------|------|
| 创建项目 | ✅ | ✅ | ✅ |
| 查看项目 | ✅ | ✅ | ✅ |
| 编辑项目 | ✅ | ✅ | ❌ |
| 删除项目 | ✅ | ✅ | ❌ |
| 管理成员 | ✅ | ✅ | ❌ |
| 查看成员 | ✅ | ✅ | ✅ |

### 权限控制

- **API级别**：使用 `@Roles` 装饰器控制访问
- **前端级别**：基于用户角色显示/隐藏功能
- **数据级别**：确保用户只能访问有权限的数据

## 配置说明

### 环境变量

```env
# 数据库配置
DATABASE_URL=mysql://user:password@localhost:3306/database

# JWT配置
JWT_SECRET=your-secret-key

# 其他配置
NODE_ENV=development
PORT=3000
```

### 数据库迁移

项目创建后需要运行数据库迁移：

```bash
cd server
npm run migration:run
```

## 故障排除

### 常见问题

1. **无法创建项目**
   - 检查用户权限
   - 确认项目KEY唯一性
   - 查看后端错误日志

2. **无法添加成员**
   - 确认用户存在
   - 检查用户是否已是成员
   - 验证权限设置

3. **页面显示异常**
   - 检查浏览器控制台错误
   - 确认API响应格式
   - 验证组件导入

### 调试方法

1. **后端调试**
   - 启用SQL日志记录
   - 查看API响应
   - 检查数据库状态

2. **前端调试**
   - 使用浏览器开发者工具
   - 检查网络请求
   - 查看控制台错误

## 扩展功能

### 未来计划

1. **批量操作**：支持批量添加/移除成员
2. **权限细化**：更细粒度的权限控制
3. **通知系统**：成员变更通知
4. **审计日志**：操作记录和审计
5. **导入导出**：项目数据导入导出

### 自定义扩展

- 添加新的项目字段
- 扩展成员角色类型
- 集成外部用户系统
- 添加项目模板功能

## 总结

项目管理和用户关联功能提供了完整的项目生命周期管理能力，支持：

- ✅ 完整的项目CRUD操作
- ✅ 灵活的用户关联管理
- ✅ 基于角色的权限控制
- ✅ 直观的用户界面
- ✅ 响应式设计
- ✅ 安全的数据处理

该功能为项目管理工具提供了坚实的基础，支持团队协作和项目管理需求。
