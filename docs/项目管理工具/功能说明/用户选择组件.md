# 用户选择组件功能说明

## 概述

创建了一个通用的用户选择组件 `UserSelector`，用于在Issues中方便地派发给特定用户负责。该组件支持搜索、选择项目成员，并提供了良好的用户体验。

## 组件特性

### 1. 基本功能
- **用户搜索**：支持按用户名搜索
- **项目成员过滤**：可选择项目内的成员
- **实时搜索**：输入时实时过滤用户列表
- **头像显示**：显示用户头像和姓名
- **邮箱显示**：显示用户邮箱信息

### 2. 交互特性
- **下拉加载**：下拉时自动加载用户列表
- **清空选择**：支持清空已选择的用户
- **禁用状态**：支持禁用组件
- **加载状态**：显示加载中状态

## 组件API

### Props
```typescript
interface Props {
  modelValue?: string;           // 选中的用户ID
  placeholder?: string;          // 占位符文本
  disabled?: boolean;            // 是否禁用
  allowClear?: boolean;          // 是否允许清空
  projectId?: string;           // 项目ID，用于过滤项目成员
}
```

### Events
```typescript
interface Emits {
  (e: 'update:modelValue', value: string | undefined): void;
  (e: 'change', value: string | undefined, user: User | undefined): void;
}
```

### 暴露的方法
```typescript
defineExpose({
  loadUsers: () => void;        // 重新加载用户列表
  clear: () => void;            // 清空选择
});
```

## 使用场景

### 1. Issues列表页面
- **负责人选择**：创建/编辑事项时选择负责人
- **报告人选择**：创建/编辑事项时选择报告人
- **过滤功能**：按负责人过滤事项列表

### 2. Issues详情页面
- **实时编辑**：直接在详情页面修改负责人和报告人
- **即时保存**：选择后自动保存到后端

## 集成位置

### 1. Issues页面 (`client/src/views/Issues.vue`)
```vue
<!-- 过滤条件中的负责人选择 -->
<UserSelector 
  v-model="assigneeId" 
  placeholder="负责人" 
  :project-id="projectId"
  style="width:200px"
  allow-clear
/>

<!-- 创建/编辑表单中的负责人选择 -->
<UserSelector 
  v-model="formData.assigneeId" 
  placeholder="请选择负责人" 
  :project-id="projectId"
  allow-clear
/>
```

### 2. IssueDetail页面 (`client/src/views/IssueDetail.vue`)
```vue
<!-- 负责人选择 -->
<UserSelector 
  v-model="issue.assigneeId" 
  :project-id="projectId"
  placeholder="未分配"
  @change="handleAssigneeChange"
/>

<!-- 报告人选择 -->
<UserSelector 
  v-model="issue.reporterId" 
  :project-id="projectId"
  placeholder="未指定"
  @change="handleReporterChange"
/>
```

## 后端支持

### 1. API更新
- **CreateIssueDto**：添加 `assigneeId` 和 `reporterId` 字段
- **UpdateIssueDto**：添加 `assigneeId` 和 `reporterId` 字段
- **IssuesService**：支持按 `assigneeId` 过滤

### 2. 数据库字段
- `assignee_id`：负责人ID（可空）
- `reporter_id`：报告人ID（可空）

## 用户体验优化

### 1. 视觉设计
- **头像显示**：使用用户头像或姓名首字母
- **信息完整**：显示姓名和邮箱
- **状态反馈**：加载状态和错误提示

### 2. 交互优化
- **实时搜索**：输入时立即过滤
- **懒加载**：下拉时才加载数据
- **错误处理**：网络错误时显示友好提示

### 3. 性能优化
- **分页加载**：限制每次加载50个用户
- **搜索防抖**：避免频繁请求
- **缓存机制**：避免重复加载

## 使用示例

### 1. 基本使用
```vue
<template>
  <UserSelector 
    v-model="selectedUserId"
    placeholder="请选择用户"
    @change="handleUserChange"
  />
</template>

<script setup>
const selectedUserId = ref();
const handleUserChange = (userId, user) => {
  console.log('选择的用户:', userId, user);
};
</script>
```

### 2. 项目成员选择
```vue
<template>
  <UserSelector 
    v-model="assigneeId"
    :project-id="projectId"
    placeholder="选择负责人"
    allow-clear
  />
</template>
```

### 3. 禁用状态
```vue
<template>
  <UserSelector 
    v-model="userId"
    :disabled="!canEdit"
    placeholder="选择用户"
  />
</template>
```

## 技术实现

### 1. 组件架构
- **Vue 3 Composition API**：使用最新的Vue 3特性
- **TypeScript**：完整的类型支持
- **Ant Design Vue**：基于成熟的UI组件库

### 2. 数据流
- **Props Down**：通过props传递配置
- **Events Up**：通过events向上传递变化
- **v-model**：支持双向绑定

### 3. 错误处理
- **网络错误**：显示友好错误信息
- **数据验证**：确保数据格式正确
- **回滚机制**：操作失败时恢复原值

这个用户选择组件提供了完整的用户选择功能，支持搜索、过滤、实时编辑等特性，为Issues管理提供了良好的用户体验。
